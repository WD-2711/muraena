# make all æ—¶å…ˆè¿è¡Œ build
all: build

# make ä¹‹å‰å…ˆè°ƒç”¨ pre
pre:
	mkdir -p build
    # æ ¹æ® go.mod æ¥ä¸‹è½½ä¾èµ–é¡¹
	env GO111MODULE=on go get -d ./

# è¿è¡Œ build å‰å…ˆè¿è¡Œ pre
build: pre
	go build -o build/muraena .

# æœ‰ç«äº‰æ£€æµ‹åŠŸèƒ½
build_with_race_detector: pre
	go build -race -o build/muraena .

buildall: pre
	env GO111MODULE=on GOOS=darwin GOARCH=amd64 go build -o build/macos/muraena .
	env GO111MODULE=on GOOS=linux GOARCH=amd64 go build -o build/linux/muraena .
	env GO111MODULE=on GOOS=windows GOARCH=amd64 go build -o  build/windows/muraena.exe .

update:
	# å°†ä¾èµ–é¡¹æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
	go get -u
	# å°†ä¾èµ–é¡¹å¤åˆ¶åˆ°é¡¹ç›®æœ¬åœ°çš„ vendor ç›®å½•ä¸­ï¼Œç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„ä¾èµ–é¡¹åº“ï¼Œä½¿å¾—é¡¹ç›®å¯ä»¥åœ¨ä¸ä¾èµ–äºå¤–éƒ¨çš„æƒ…å†µä¸‹è¿›è¡Œæ„å»ºå’Œç¼–è¯‘
	go mod vendor
	# æ•´ç†å’Œæ›´æ–°é¡¹ç›®çš„æ¨¡å—ä¾èµ–å…³ç³»
	go mod tidy
	# æ·»åŠ æ›´æ”¹ä¾èµ–çš„æ¶ˆæ¯åˆ° github
	@git commit go.mod go.sum -m "Bump dependencies ğŸ“ˆ"

lint: fmt
	# å°†ç®€åŒ–çš„ä»£ç æ¨åˆ° github
	@git add . && git commit -a -m "Code linting :star2:"

fmt:
	# ç®€åŒ–ä»£ç å¹¶é‡å†™
	gofmt -s -w core log session module module/crawler module/necrobrowser module/statichttp module/tracking module/watchdog

# è¡¨ç¤º all build build_with_race_detector lint fmt æ˜¯å‘½ä»¤ï¼Œè€Œä¸æ˜¯æ–‡ä»¶
.PHONY: all build build_with_race_detector lint fmt
